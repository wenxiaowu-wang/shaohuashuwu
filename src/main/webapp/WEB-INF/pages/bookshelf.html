<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>书架测试</title>
    <link rel="icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="../css/elementui.css">
    <link rel="stylesheet" href="../css/comment.css">
    <link rel="stylesheet" href="http://rcode.zongheng.com/v2018/css/basic.min.css"/>
    <link rel="stylesheet" href="http://rcode.zongheng.com/v2018/css/home.min.css"/>


</head>
<body>

<div class="wrap" id="bookShelf">
    <div class="hsub">
        <div class="hsub_tab">
            <ul>
                <li class="bookshelf"><a href="bookshelfInterface"><font color="black">我的书架</font></a></li>
                <li class="spline"></li>
                <li class=""><a href="readingHistoryInterface">最近阅读</a></li>
            </ul>
        </div>
        <div class="hsub_r">
            当前书架收藏书籍{{book_num}}本
        </div>
    </div>
    <!-- 主箱体 -->
    <div class="home-main">
        <!-- 列表箱体 -->
        <div class="home_innerwrap">
            <div class="shelf_list_tit listType_a">
                <div class="catName">类别</div>
                <div class="bookName">书名</div>
                <div class="author">作者</div>
                <div class="upDateChapter">最新章节</div>
                <div class="bookStatus">状态</div>
                <div class="updateTime">更新时间</div>
                <div class="ctrlBook">操作</div>
            </div>

            <template v-if=" book_num == 0 ">
                <div class="no-data"><img src="../images/no-book.png">
                    <p>书架空了，快去添加吧~ </p></div>
            </template>

            <template v-else>

                <li class="shelf_bookLine listType_a" v-for="work in tableData">
                    <div class="bookSelecter">
                        <label>
                            <input type="checkbox" autocomplete="on" class="chapter-checkbox" data-bookId=""
                            ><em
                                class="checkbox em_checked"></em>
                        </label>
                    </div>
                    <div class="catName">{{work.work_main_label}}</div>
                    <div class="bookName">
                        <a href="" target="_blank" class="txtove">{{work.work_name}}</a>
                    </div>
                    <div class="author"><a href="" class="txtove" target="_blank">{{work.user_name}}</a></div>
                    <div class="upDateChapter"><a href="" class="txtove" target="_blank">{{work.chapter_title}}</a></div>
                    <div class="bookStatus">{{work.work_serial_state}}</div>
                    <div class="updateTime">{{work.chapter_time}}</div>
                    <div class="ctrlBook"><a href="" target="_blank" class="redbtn">继续阅读</a></div>
                </li>
            </template>


        </div>

        <div class="home_innerbot pagenumber clear">
            <div class="fl">
                <!--                <label class="bookSelecter">-->
                <!--                    <input type="checkbox"  autocomplete="off" class="chapter-checkbox" value="">-->
                <!--                    <em class="checkbox em_checked"></em>-->
                <!--                    <span>全选</span>-->
                <!--                </label>-->
                <!--                <a class="btngry"  @click="deleteBookshelfWork()">删除</a>-->

                <button @click="deleteBookshelfWork">删除</button>

                <button @click="deleteHistoryWorkByWorkId">删除单个历史记录</button>
                <button @click="deleteHistoryWorkByUserId">清空历史记录</button>

                <button @click="subscriptionChapter">订阅本章</button>
                <button @click="subscriptionAllChapter">订阅全部（不包含未更新部分）</button>

                <button @click="dialogFormVisible = true">评论图书</button>




                <el-dialog class="dialog_work" title="书籍评论" :visible.sync="dialogFormVisible">

                    <div>
                        <div class="comment_input">
                            <el-input
                                    id="Remark_information"
                                    name="Remark_information"
                                    type="textarea"
                                    :autosize="{ minRows: 2, maxRows: 4}"
                                    placeholder="请输入评论内容"
                                    v-model="textarea">
                            </el-input>
                        </div>
                        <div class="comment_input">
                            <span id="stay"> <span id="txtCount"></span>/200</span></span>
                            <button class="comment_btn" @click="submit_comment">发表评论</button>
                        </div>
                    </div>

                    <div class="comment-parent" v-for="comment in commentData">
                        <div class="comment-parent_info">
                            <div class="comment-parent_head">
                                <el-avatar :size="50"
                                           :src="imageURL_header+comment.head_portrait+imageURL_suffix"></el-avatar>
                            </div>
                            <div class="comment-parent_info3">
                                <span class="username">{{comment.user_name}}</span><br/>
                                <span class="comment-time">发表时间:{{comment.comment_time}}</span>
                                <button class="reply_comment_btn" @click="changeDisplayReply(comment.comment_id)">
                                    {{comment.reply_comment_btn}}
                                </button>

                                <button class="reply_comment_btn_2" @click="changeDisplayReply2(comment.comment_id)">
                                    {{comment.reply_comment_btn2}}
                                </button>
                            </div>
                        </div>
                        <div class="comment_content">
                            {{comment.comment_content}}
                        </div>


                        <div :style="'display: '+ comment.displayReply">
                            <div class="reply_comment_input">
                                <el-input
                                        type="textarea"
                                        :autosize="{ minRows: 2, maxRows: 4}"
                                        placeholder="请输入回复内容"
                                        v-model="textarea_reply">
                                </el-input>
                            </div>
                            <div class="comment_input">
                                <button class="comment_btn2" @click="submit_commentReply(comment.comment_id)">回复评论
                                </button>
                            </div>
                        </div>

                        <template v-if=" comment.reply_comment_btn2 === '收起' ">
                            <div class="comment-child" v-for="commentChild in commentChildData">

                                <template v-if=" comment.comment_id == commentChild.comment_pid ">

                                    <div class="comment-child_info">
                                        <div class="comment-child_head">
                                            <el-avatar :size="50"
                                                       :src="imageURL_header+commentChild.head_portrait+imageURL_suffix"></el-avatar>
                                        </div>
                                        <div class="comment-child_info3">
                                            <span class="username_child">{{commentChild.user_name}} 回复 {{comment.user_name}}</span><br/>
                                            <span class="comment-time">发表时间:{{commentChild.comment_time}}</span>

                                            <button class="reply_comment_btn"
                                                    @click="changeDisplayReplyChild(commentChild.comment_id)">
                                                {{commentChild.reply_comment_btn}}
                                            </button>

                                        </div>

                                        <div class="comment-child_content">
                                            {{commentChild.comment_content}}
                                        </div>

                                    </div>

                                    <div :style="'display:'+ commentChild.displayReply">
                                        <div class="reply_comment_input-child">
                                            <el-input
                                                    type="textarea"
                                                    :autosize="{ minRows: 2, maxRows: 4}"
                                                    placeholder="请输入回复内容"
                                                    v-model="textarea_reply_child">
                                            </el-input>
                                        </div>
                                        <div class="comment_input">
                                            <button class="comment_btn2"
                                                    @click="submit_commentReplyChild(comment.comment_id)">回复评论
                                            </button>
                                        </div>
                                    </div>
                                    <br>
                                </template>
                            </div>
                        </template>
                        <hr/>
                    </div>

                </el-dialog>

            </div>

        </div>

    </div>
</div>


<script src="../js/vue.js"></script>
<script src="../js/elementui.js"></script>
<script src="../js/axios.js"></script>
<script src="../js/bookShelf.js"></script>
<script>
    var lim = new limit();
    lim.txtNote = document.getElementById("Remark_information");
    lim.txtLimit = document.getElementById("txtCount");
    lim.limitCount = 200;
    lim.init();

    function limit() {
        var txtNote; //文本框
        var txtLimit; //提示字数的input
        var limitCount; //限制的字数
        var txtlength; //到达限制时，字符串的长度
        this.init = function () {
            txtNote = this.txtNote;
            txtLimit = this.txtLimit;
            limitCount = this.limitCount;
            txtNote.oninput = function () {
                wordsLimit()
            };
            txtNote.oninput = function () {
                wordsLimit()
            };
            txtLimit.innerText = limitCount;
        };

        function wordsLimit() {
            var noteCount = txtNote.value.length;
            var InPut = document.getElementById("Remark_information").value.length;

            if (InPut >= 1) {
                document.getElementById("stay").style.display = "inline";
                document.getElementById("stay").style.color = "green";
            }
            if (InPut > 70) {
                document.getElementById("stay").style.color = "red";
            }
            if (noteCount > limitCount) {
                txtNote.value = txtNote.value.substring(0, limitCount);
                txtLimit.innerText = 0;
            } else {
                txtLimit.innerText = limitCount - noteCount;
            }
            txtlength = txtNote.value.length; //记录每次输入后的长度
        }
    }
</script>
</body>
</html>



